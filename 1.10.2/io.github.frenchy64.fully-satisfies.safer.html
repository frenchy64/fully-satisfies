<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>io.github.frenchy64.fully-satisfies.safer documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Fully-satisfies</span> <span class="project-version">1.10.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>github</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>frenchy64</span></div></div></li><li class="depth-4"><a href="io.github.frenchy64.fully-satisfies.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fully-satisfies</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.clearing-future.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clearing-future</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.everyp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>everyp</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.expand-kvs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>expand-kvs</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.folda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>folda</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.head-releasing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>head-releasing</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.latest-protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>latest-protocol</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.lazier.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazier</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.leaky-seq-detection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>leaky-seq-detection</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.linear.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>linear</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.never.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>never</span></div></a></li><li class="depth-5"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>non-leaky-macros</span></div></div></li><li class="depth-6"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clojure</span></div></div></li><li class="depth-7"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-8 branch"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.core.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-8"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logic</span></div></div></li><li class="depth-9"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.core.logic.pldb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pldb</span></div></a></li><li class="depth-8"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>match</span></div></div></li><li class="depth-9"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.core.match.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-7"><div class="no-link"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>java</span></div></div></li><li class="depth-8 branch"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.java.jmx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jmx</span></div></a></li><li class="depth-8"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.java.shell.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shell</span></div></a></li><li class="depth-7 branch"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.pprint.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>pprint</span></div></a></li><li class="depth-7"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-8"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check</span></div></div></li><li class="depth-9 branch"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.test.check.generators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generators</span></div></a></li><li class="depth-9"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.test.check.properties.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>properties</span></div></a></li><li class="depth-8"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.test.tap.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tap</span></div></a></li><li class="depth-7"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>tools</span></div></div></li><li class="depth-8"><a href="io.github.frenchy64.fully-satisfies.non-leaky-macros.clojure.tools.trace.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>trace</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.partially-satisfies.html"><div class="inner"><span class="tree" style="top: -579px;"><span class="top" style="height: 588px;"></span><span class="bottom"></span></span><span>partially-satisfies</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.reify-spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reify-spec</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.run-all.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>run-all</span></div></a></li><li class="depth-5 branch current"><a href="io.github.frenchy64.fully-satisfies.safer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>safer</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.shared-protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shared-protocol</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.somef.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>somef</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.uncaught-testing-contexts.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uncaught-testing-contexts</span></div></a></li><li class="depth-5 branch"><a href="io.github.frenchy64.fully-satisfies.uniform.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uniform</span></div></a></li><li class="depth-5"><a href="io.github.frenchy64.fully-satisfies.vector-overflow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vector-overflow</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-butlast"><div class="inner"><span>butlast</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-drop-last"><div class="inner"><span>drop-last</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-every.3F"><div class="inner"><span>every?</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-last"><div class="inner"><span>last</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-not-every.3F"><div class="inner"><span>not-every?</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-partitionv-all"><div class="inner"><span>partitionv-all</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-sort"><div class="inner"><span>sort</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-sort-by"><div class="inner"><span>sort-by</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-split-at"><div class="inner"><span>split-at</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-split-with"><div class="inner"><span>split-with</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-splitv-at"><div class="inner"><span>splitv-at</span></div></a></li><li class="depth-1"><a href="io.github.frenchy64.fully-satisfies.safer.html#var-take-last"><div class="inner"><span>take-last</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">io.github.frenchy64.fully-satisfies.safer</h1><div class="doc"><pre class="plaintext">Variants of clojure.core functions that improve thread-safety and general robustness
when passed mutating collections.

We agree that 'Robust programs should not mutate arrays or Iterables that have seqs on them.'
<a href="https://clojure.org/reference/sequences">https://clojure.org/reference/sequences</a>
Eductions inhabit a middle ground. They are designed to be walked from first to last like seqs,
but each element is recomputed when 

For example, clojure.core/split-at could disagree on the take/drop parts of
the collection if the coll is mutated between realizing the splits.
Here, any one call to the eduction alternates between [0 1 2 3 4 5 6 7 8 9] and
[9 8 7 6 5 4 3 2 1 0]. However, split-at incorrectly splits the eduction as
[[0 1 2 3 4] [4 3 2 1 0]], and safer/split-at correctly splits it as
[[0 1 2 3 4] [5 6 7 8 9]].

(deftest split-at-mutation-test
  (let [up-down (atom true)
        ed (eduction (map (fn [i]
                            (when (zero? i)
                              (swap! up-down not))
                            (if @up-down
                              (- 9 i)
                              i)))
                     (range 10))]
    (is (= [[0 1 2 3 4] [4 3 2 1 0]] (split-at 5 ed)))
    (is (= [[0 1 2 3 4] [5 6 7 8 9]] (safer/split-at 5 ed)))))

See io.github.frenchy64.fully-satisfies.safer-test for more details.

The basic trick here is strategically calling seq earlier on the collection argument.</pre></div><div class="public anchor" id="var-butlast"><h3>butlast</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(butlast coll)</code></div><div class="doc"><pre class="plaintext">Return a seq of all but the last item in coll, in linear time

safer/butlast additionally:
- is threadsafe for mutable collections, at the cost of an additional
  call to seq.
- calls next once per element instead of twice.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L201">view source</a></div></div><div class="public anchor" id="var-drop-last"><h3>drop-last</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(drop-last coll)</code><code>(drop-last n coll)</code></div><div class="doc"><pre class="plaintext">Return a lazy sequence of all but the last n (default 1) items in coll

safer/drop-last additionally is thread-safe for mutable collections,
at the cost of a call to seq.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L71">view source</a></div></div><div class="public anchor" id="var-every.3F"><h3>every?</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(every? pred coll)</code></div><div class="doc"><pre class="plaintext">Returns true if (pred x) is logical true for every x in coll, else
false.

safer/every? additionally is thread-safe for mutable collections.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L45">view source</a></div></div><div class="public anchor" id="var-last"><h3>last</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(last coll)</code></div><div class="doc"><pre class="plaintext">Return the last item in coll, in linear time

safer/last additionally:
- is thread-safe for mutable collections, at the cost of a call to seq.
- calls next once every step instead of twice.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L185">view source</a></div></div><div class="public anchor" id="var-not-every.3F"><h3>not-every?</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(not-every? pred coll)</code></div><div class="doc"><pre class="plaintext">Returns false if (pred x) is logical true for every x in
coll, else true.
      
safer/not-every? additionally is thread-safe for mutable collections.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L61">view source</a></div></div><div class="public anchor" id="var-partitionv-all"><h3>partitionv-all</h3><h4 class="added">added in 1.12</h4><div class="usage"><code>(partitionv-all n)</code><code>(partitionv-all n coll)</code><code>(partitionv-all n step coll)</code></div><div class="doc"><pre class="plaintext">Returns a lazy sequence of vector partitions, but may include
partitions with fewer than n items at the end.
Returns a stateful transducer when no collection is provided.

safer/partitionv-all additionally is thread-safe for mutable collections
and generally robust against a mutating coll.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L167">view source</a></div></div><div class="public anchor" id="var-sort"><h3>sort</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(sort coll)</code><code>(sort comp coll)</code></div><div class="doc"><pre class="plaintext">Returns a sorted sequence of the items in coll. If no comparator is
supplied, uses compare.  comparator must implement
java.util.Comparator.  Guaranteed to be stable: equal elements will
not be reordered.  If coll is a Java array, it will be modified.  To
avoid this, sort a copy of the array.

safer/sort additionally is thread-safe for mutable collections (avoids NPE).</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L119">view source</a></div></div><div class="public anchor" id="var-sort-by"><h3>sort-by</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(sort-by keyfn coll)</code><code>(sort-by keyfn comp coll)</code></div><div class="doc"><pre class="plaintext">Returns a sorted sequence of the items in coll, where the sort
order is determined by comparing (keyfn item).  If no comparator is
supplied, uses compare.  comparator must implement
java.util.Comparator.  Guaranteed to be stable: equal elements will
not be reordered.  If coll is a Java array, it will be modified.  To
avoid this, sort a copy of the array.

safer/sort-by additionally is thread-safe for mutable collections (avoids NPE).</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L139">view source</a></div></div><div class="public anchor" id="var-split-at"><h3>split-at</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(split-at n coll)</code></div><div class="doc"><pre class="plaintext">Returns a vector of [(take n coll) (drop n coll)]

safer/split-at additionally is thread-safe for mutable collections
and generally robust against a mutating coll at the cost of a call to seq.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L97">view source</a></div></div><div class="public anchor" id="var-split-with"><h3>split-with</h3><h4 class="added">added in 1.0</h4><div class="usage"><code>(split-with pred coll)</code></div><div class="doc"><pre class="plaintext">Returns a vector of [(take-while pred coll) (drop-while pred coll)]

safer/split-with additionally is thread-safe for mutable collections,
and generally robust against a mutating coll at the cost of a call to seq.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L108">view source</a></div></div><div class="public anchor" id="var-splitv-at"><h3>splitv-at</h3><h4 class="added">added in 1.12</h4><div class="usage"><code>(splitv-at n coll)</code></div><div class="doc"><pre class="plaintext">Returns a vector of [(into [] (take n) coll) (drop n coll)]

safer/splitv-at additionally is thread-safe for mutable collections
and generally robust against a mutating coll.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L156">view source</a></div></div><div class="public anchor" id="var-take-last"><h3>take-last</h3><h4 class="added">added in 1.1</h4><div class="usage"><code>(take-last n coll)</code></div><div class="doc"><pre class="plaintext">Returns a seq of the last n items in coll.  Depending on the type
of coll may be no better than linear time.  For vectors, see also subvec.

safer/drop-last additionally is thread-safe for mutable collections.</pre></div><div class="src-link"><a href="https://github.com/frenchy64/fully-satisfies/blob/8566acca7ff6d6262b14b8fb188e226c55968130/src/io/github/frenchy64/fully_satisfies/safer.clj#L83">view source</a></div></div></div></body></html>